apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: cert-manager

# =============================================================================
# cert-manager Helm-based deployment
# =============================================================================
# Uses the official cert-manager Helm chart with local ARM64 image overrides.
# This approach is consistent with kgateway deployment strategy.
# =============================================================================

resources:
  - namespace.yaml

helmCharts:
  - name: cert-manager
    repo: https://charts.jetstack.io
    version: v1.19.2
    releaseName: cert-manager
    namespace: cert-manager
    valuesFile: values.yaml
    includeCRDs: true

# =============================================================================
# Image overrides for ARM64 confidential containers
# =============================================================================
# These images are built from source for ARM64 architecture using:
#   ./infrastructure/containers/cert-manager/*/Dockerfile
#
# The images are loaded into the cluster's containerd via nerdctl.
# =============================================================================
images:
  - name: quay.io/jetstack/cert-manager-controller
    newName: cert-manager-controller
    newTag: v1.19.2
  - name: quay.io/jetstack/cert-manager-cainjector
    newName: cert-manager-cainjector
    newTag: v1.19.2
  - name: quay.io/jetstack/cert-manager-webhook
    newName: cert-manager-webhook
    newTag: v1.19.2
  - name: quay.io/jetstack/cert-manager-startupapicheck
    newName: cert-manager-controller
    newTag: v1.19.2
